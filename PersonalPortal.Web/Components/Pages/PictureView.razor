@page "/pictures/{id:guid}"
@using PersonalPortal.Core.Models
@using PersonalPortal.Web.Services
@inject ApiService ApiService
@rendermode InteractiveServer

<PageTitle>Picture</PageTitle>

<div class="container">
    @if (picture == null)
    {
        <div class="text-center">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    }
    else
    {
        <div class="mb-4">
            <a href="/pictures" class="btn btn-secondary">Back to List</a>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>@(string.IsNullOrEmpty(picture.Caption) ? "Picture" : picture.Caption)</h2>
                <small class="text-muted">
                    Created: @picture.Created.ToLocalTime().ToString("g") | 
                    Updated: @picture.Updated.ToLocalTime().ToString("g")
                </small>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <img src="data:image/jpeg;base64,@Convert.ToBase64String(picture.ImageData)" 
                         class="img-fluid" 
                         alt="@picture.Caption"
                         style="max-height: 600px;">
                </div>
                @if (!string.IsNullOrEmpty(picture.Caption))
                {
                    <div class="mt-3">
                        <p><strong>Caption:</strong> @picture.Caption</p>
                    </div>
                }
                @if (picture.RecipeId.HasValue)
                {
                    <div class="mt-2">
                        <a href="/recipes/@picture.RecipeId" class="btn btn-sm btn-primary">View Recipe</a>
                    </div>
                }
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public Guid Id { get; set; }

    private Picture? picture;

    protected override async Task OnInitializedAsync()
    {
        picture = await ApiService.GetPictureByIdAsync(Id);
    }
}
